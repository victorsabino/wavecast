<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="/src/styles-new.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Wavecast - Transform Audio into Video</title>
    <meta name="description" content="Bulk audio-to-video converter for content creators, podcasters, and musicians">
    <script type="module" src="/src/main.ts" defer></script>
  </head>

  <body>
    <!-- Top Navigation Bar -->
    <nav class="top-nav">
      <div class="nav-left">
        <img src="/assets/logo-header.png" alt="Wavecast" class="app-logo-full">
        <span class="version">v1.0</span>
      </div>
      <div class="nav-right">
        <button class="nav-btn" id="theme-toggle-btn">
          <svg class="theme-icon-sun" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="5"/>
            <line x1="12" y1="1" x2="12" y2="3"/>
            <line x1="12" y1="21" x2="12" y2="23"/>
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
            <line x1="1" y1="12" x2="3" y2="12"/>
            <line x1="21" y1="12" x2="23" y2="12"/>
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
          </svg>
          <svg class="theme-icon-moon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: none;">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
          </svg>
          <span class="theme-label">Dark</span>
        </button>
        <button class="nav-btn" id="help-btn">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/>
            <line x1="12" y1="17" x2="12.01" y2="17"/>
          </svg>
          Help
        </button>
        <button class="nav-btn" id="settings-btn">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="3"/>
            <path d="M12 1v6m0 6v6"/>
          </svg>
          Settings
        </button>
      </div>
    </nav>

    <!-- Main Workflow -->
    <main class="workflow">

      <!-- STEP 1: Upload Audio Files -->
      <section class="workflow-step" id="step-audio">
        <div class="step-header">
          <div class="step-number">1</div>
          <div class="step-info">
            <h2>Audio Files</h2>
            <p class="step-desc">Add your audio files (MP3, WAV, M4A)</p>
          </div>
          <div class="step-stats">
            <span class="stat-badge" id="audio-count">0 files</span>
          </div>
        </div>

        <div class="drop-zone" id="audio-drop-zone">
          <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <path d="M9 18V5l12-2v13"/>
            <circle cx="6" cy="18" r="3"/>
            <circle cx="18" cy="16" r="3"/>
          </svg>
          <h3>Drop audio files here or click to browse</h3>
          <p>Supports MP3, WAV, M4A, OGG • Max 500 files</p>
          <button class="primary-btn" id="browse-audio-btn">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M9 18V5l12-2v13"/>
              <circle cx="6" cy="18" r="3"/>
              <circle cx="18" cy="16" r="3"/>
            </svg>
            Browse Audio Files
          </button>
        </div>

        <!-- Audio List (appears after upload) -->
        <div class="file-list" id="audio-list" style="display: none;">
          <div class="list-header">
            <div class="list-actions">
              <button class="icon-btn" id="add-more-audio">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="12" y1="5" x2="12" y2="19"/>
                  <line x1="5" y1="12" x2="19" y2="12"/>
                </svg>
                Add More
              </button>
              <button class="icon-btn danger" id="clear-audio">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="3 6 5 6 21 6"/>
                  <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                </svg>
                Clear All
              </button>
            </div>
          </div>
          <div class="scrollable-list" id="audio-table">
            <!-- Audio files will be populated here -->
          </div>
        </div>
      </section>

      <!-- STEP 2: Music Pool -->
      <section class="workflow-step" id="step-music">
        <div class="step-header">
          <div class="step-number">2</div>
          <div class="step-info">
            <h2>Music Pool</h2>
            <p class="step-desc">Add music tracks (random assignment)</p>
          </div>
          <div class="step-stats">
            <span class="stat-badge" id="music-count">0 tracks</span>
          </div>
        </div>

        <div class="drop-zone" id="music-drop-zone">
          <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <path d="M9 18V5l12-2v13"/>
            <circle cx="6" cy="18" r="3"/>
            <circle cx="18" cy="16" r="3"/>
          </svg>
          <h3>Drop music files here</h3>
          <p>Supports MP3, WAV, M4A • Will be randomly assigned</p>
          <button class="primary-btn" id="browse-music-btn">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M9 18V5l12-2v13"/>
              <circle cx="6" cy="18" r="3"/>
              <circle cx="18" cy="16" r="3"/>
            </svg>
            Browse Music
          </button>
        </div>

        <!-- Music List -->
        <div class="file-list" id="music-list" style="display: none;">
          <div class="list-header">
            <div class="music-mode-toggle">
              <label class="toggle-label">
                <input type="checkbox" id="random-mode-toggle" checked>
                <span class="toggle-slider"></span>
                <span class="toggle-text">Random Assignment</span>
              </label>
            </div>
            <div class="list-actions">
              <button class="icon-btn" id="add-more-music">+ Add More</button>
              <button class="icon-btn danger" id="clear-music">Clear All</button>
            </div>
          </div>
          <div class="scrollable-list" id="music-table">
            <!-- Music tracks will be populated here -->
          </div>
        </div>
      </section>

      <!-- STEP 3: Background Setup -->
      <section class="workflow-step" id="step-background">
        <div class="step-header">
          <div class="step-number">3</div>
          <div class="step-info">
            <h2>Background</h2>
            <p class="step-desc">Choose image or solid color</p>
          </div>
        </div>

        <div class="background-selector">
          <div class="bg-tabs">
            <button class="bg-tab active" data-tab="image">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="3" width="18" height="18" rx="2"/>
                <circle cx="8.5" cy="8.5" r="1.5"/>
                <polyline points="21 15 16 10 5 21"/>
              </svg>
              Image
            </button>
            <button class="bg-tab" data-tab="color">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
              </svg>
              Solid Color
            </button>
          </div>

          <!-- Image Tab -->
          <div class="bg-content active" id="bg-image-content">
            <div class="drop-zone compact" id="image-drop-zone">
              <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <rect x="3" y="3" width="18" height="18" rx="2"/>
                <circle cx="8.5" cy="8.5" r="1.5"/>
                <polyline points="21 15 16 10 5 21"/>
              </svg>
              <button class="secondary-btn" id="browse-image-btn">Browse Image</button>
              <img id="bg-image-preview" class="bg-preview-img" style="display: none;">
            </div>
            <div class="bg-options" id="image-options" style="display: none;">
              <label>Background Style:</label>
              <select id="background-style">
                <option value="cover">Fill (Cover)</option>
                <option value="contain">Fit (Contain)</option>
                <option value="repeat">Repeat</option>
                <option value="center">Center</option>
              </select>
            </div>
          </div>

          <!-- Color Tab -->
          <div class="bg-content" id="bg-color-content">
            <div class="color-picker-wrapper">
              <input type="color" id="bg-color-picker" value="#667eea">
              <div class="color-presets">
                <button class="color-preset" style="background: #667eea" data-color="#667eea"></button>
                <button class="color-preset" style="background: #764ba2" data-color="#764ba2"></button>
                <button class="color-preset" style="background: #f093fb" data-color="#f093fb"></button>
                <button class="color-preset" style="background: #4facfe" data-color="#4facfe"></button>
                <button class="color-preset" style="background: #43e97b" data-color="#43e97b"></button>
                <button class="color-preset" style="background: #fa709a" data-color="#fa709a"></button>
                <button class="color-preset" style="background: #30cfd0" data-color="#30cfd0"></button>
                <button class="color-preset" style="background: #000000" data-color="#000000"></button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Timeline Editor (shown after files are selected) -->
      <section class="workflow-step full-width" id="step-timeline" style="display: none;">
        <div class="step-header">
          <div class="step-number">3.5</div>
          <div class="step-info">
            <h2>Timeline Editor</h2>
            <p class="step-desc">Arrange and edit your audio files and music tracks</p>
          </div>
        </div>

        <!-- Timeline Container -->
        <div id="timeline-container" class="timeline-container">
          <div class="timeline-controls">
            <button id="timeline-play" class="timeline-control-btn" title="Play/Pause (Space)">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polygon points="5 3 19 12 5 21 5 3"/>
              </svg>
            </button>
            <span id="timeline-time" class="timeline-time">00:00.000</span>
            <div class="timeline-divider"></div>
            <button id="split-clip-btn" class="timeline-control-btn" title="Split Clip at Playhead (S)" disabled>
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="12" y1="5" x2="12" y2="19"/>
                <polyline points="9 8 12 5 15 8"/>
                <polyline points="9 16 12 19 15 16"/>
              </svg>
            </button>
            <div class="timeline-divider"></div>
            <div class="timeline-zoom-controls">
              <button id="zoom-out" class="timeline-control-btn" title="Zoom Out (-)">-</button>
              <span id="zoom-level">100%</span>
              <button id="zoom-in" class="timeline-control-btn" title="Zoom In (+)">+</button>
            </div>
          </div>
          <div class="timeline-ruler" id="timeline-ruler"></div>
          <div class="timeline-tracks" id="timeline-tracks"></div>
          <div class="timeline-playhead" id="timeline-playhead"></div>
        </div>
      </section>

      <!-- STEP 4: Bulk Metadata Editor -->
      <section class="workflow-step full-width" id="step-metadata">
        <div class="step-header">
          <div class="step-number">4</div>
          <div class="step-info">
            <h2>Video Metadata</h2>
            <p class="step-desc">Edit titles & descriptions for output videos</p>
          </div>
          <div class="step-actions">
            <button class="secondary-btn" id="auto-fill-metadata">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                <polyline points="3.27 6.96 12 12.01 20.73 6.96"/>
                <line x1="12" y1="22.08" x2="12" y2="12"/>
              </svg>
              Auto-fill from Filenames
            </button>
            <button class="secondary-btn" id="use-template">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                <polyline points="14 2 14 8 20 8"/>
                <line x1="16" y1="13" x2="8" y2="13"/>
                <line x1="16" y1="17" x2="8" y2="17"/>
                <polyline points="10 9 9 9 8 9"/>
              </svg>
              Use Template
            </button>
          </div>
        </div>

        <!-- Metadata Table -->
        <div class="metadata-table-container">
          <table class="metadata-table" id="metadata-table">
            <thead>
              <tr>
                <th style="width: 40px">#</th>
                <th style="width: 200px">Filename</th>
                <th style="width: 200px">Music Track</th>
                <th>Title</th>
                <th style="width: 250px">Description</th>
                <th style="width: 100px">Actions</th>
              </tr>
            </thead>
            <tbody id="metadata-tbody">
              <!-- Rows will be populated dynamically -->
            </tbody>
          </table>
        </div>
      </section>

    </main>

    <!-- Bottom Action Bar -->
    <footer class="action-bar">
      <div class="action-bar-left">
        <button class="text-btn" id="reset-all">Reset All</button>
        <span class="status-text" id="status-text">Ready to process</span>
      </div>
      <div class="action-bar-right">
        <div class="export-settings">
          <label>Format:</label>
          <select id="export-format">
            <option value="mp4">MP4 (H.264)</option>
            <option value="mov">MOV</option>
            <option value="webm">WebM</option>
          </select>
          <label>Quality:</label>
          <select id="export-quality">
            <option value="high">High</option>
            <option value="medium" selected>Medium</option>
            <option value="low">Low</option>
          </select>
        </div>
        <button class="cta-btn" id="process-all-btn" disabled>
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <polyline points="12 6 12 12 16 14"/>
          </svg>
          Create All Videos
          <span class="btn-badge" id="process-count">0</span>
        </button>
      </div>
    </footer>

    <!-- Progress Overlay -->
    <div id="progress-overlay" class="progress-overlay" style="display: none;">
      <div class="progress-modal">
        <h2>Processing Videos...</h2>
        <div class="progress-stats">
          <span id="current-video">Processing video 1 of 60</span>
          <span id="estimated-time">Estimated time: 5 minutes</span>
        </div>
        <div class="progress-bar-wrapper">
          <div class="progress-bar-fill" id="progress-bar-fill" style="width: 0%"></div>
        </div>
        <p class="progress-percentage" id="progress-percentage">0%</p>
        <p class="progress-details" id="progress-details">Starting export...</p>
        <button class="secondary-btn" id="cancel-process">Cancel</button>
      </div>
    </div>

    <!-- Settings Modal (reuse existing) -->
    <div id="settings-modal" class="modal" style="display: none;">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Settings</h2>
          <button id="close-modal" class="close-btn">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"/>
              <line x1="6" y1="6" x2="18" y2="18"/>
            </svg>
          </button>
        </div>
        <div class="modal-body">
          <div class="setting-section">
            <h3>Vimeo Integration</h3>
            <div class="form-group">
              <label>Vimeo Access Token</label>
              <input type="text" id="vimeo-token" placeholder="Paste your Vimeo access token here" />
              <small style="color: #999;">Get your token from <a href="https://developer.vimeo.com/apps" target="_blank" style="color: #667eea;">Vimeo Developer Apps</a></small>
            </div>
          </div>
          <div class="setting-section">
            <h3>Export Settings</h3>
            <div class="form-group">
              <label>Default Output Directory</label>
              <input type="text" placeholder="/Users/me/Videos/Output" />
            </div>
            <div class="form-group">
              <label>
                <input type="checkbox" checked>
                Open output folder after processing
              </label>
            </div>
          </div>
          <div class="setting-section">
            <h3>Performance</h3>
            <div class="form-group">
              <label>Max Concurrent Processes</label>
              <select>
                <option value="1">1 (Slower, less CPU)</option>
                <option value="2" selected>2 (Balanced)</option>
                <option value="4">4 (Faster, more CPU)</option>
              </select>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button id="save-settings" class="primary-btn">Save Settings</button>
        </div>
      </div>
    </div>

    <!-- Processed Videos Modal -->
    <div id="videos-result-modal" class="modal" style="display: none;">
      <div class="modal-content" style="max-width: 900px;">
        <div class="modal-header">
          <h2>Processed Videos</h2>
          <button id="close-videos-modal" class="close-btn">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"/>
              <line x1="6" y1="6" x2="18" y2="18"/>
            </svg>
          </button>
        </div>
        <div class="modal-body">
          <p style="margin-bottom: 20px; color: #999;">Your videos have been processed successfully. Preview and publish to Vimeo.</p>
          <div class="videos-table-container" style="max-height: 500px; overflow-y: auto;">
            <table class="metadata-table" id="videos-result-table">
              <thead>
                <tr>
                  <th style="width: 40px">#</th>
                  <th>Title</th>
                  <th style="width: 100px">Preview</th>
                  <th style="width: 100px">Location</th>
                  <th style="width: 120px">Actions</th>
                </tr>
              </thead>
              <tbody id="videos-result-tbody">
                <!-- Rows will be populated dynamically -->
              </tbody>
            </table>
          </div>
        </div>
        <div class="modal-footer" style="flex-direction: column; gap: 12px;">
          <div id="vimeo-error-message" style="display: none; color: #dc2626; font-size: 14px; text-align: center; padding: 8px; background: #fef2f2; border-radius: 6px; width: 100%;">
            <span id="vimeo-error-text"></span>
            <a href="#" id="open-settings-link" style="color: #dc2626; font-weight: 600; margin-left: 4px;">Open Settings</a>
          </div>
          <div style="display: flex; gap: 12px; justify-content: flex-end; width: 100%;">
            <button id="publish-all-btn" class="primary-btn">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="17 8 12 3 7 8"/>
                <line x1="12" y1="3" x2="12" y2="15"/>
              </svg>
              Publish All to Vimeo
            </button>
            <button id="close-videos-modal-btn" class="secondary-btn">Close</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Video Preview Modal -->
    <div id="video-preview-modal" class="modal" style="display: none;">
      <div class="modal-content" style="max-width: 800px;">
        <div class="modal-header">
          <h2 id="preview-video-title">Video Preview</h2>
          <button id="close-preview-modal" class="close-btn">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"/>
              <line x1="6" y1="6" x2="18" y2="18"/>
            </svg>
          </button>
        </div>
        <div class="modal-body">
          <video id="preview-video-player" controls style="width: 100%; max-height: 500px; background: #000;"></video>
        </div>
        <div class="modal-footer">
          <button id="close-preview-modal-btn" class="secondary-btn">Close</button>
        </div>
      </div>
    </div>

  </body>
</html>
